<!DOCTYPE html>
<html lang="en" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Onward Dominicans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              slate: {
                50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1',
                400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155',
                800: '#1e293b', 900: '#0f172a',
              }
            }
          }
        }
      }
    </script>
    <style>
      body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #f0f0f0; }
      html.dark ::-webkit-scrollbar-track { background: #2d3748; }
      ::-webkit-scrollbar-thumb { background: #a0a0a0; border-radius: 4px; }
      html.dark ::-webkit-scrollbar-thumb { background: #718096; }
      .fade-in { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
      .fade-in.visible { opacity: 1; transform: translateY(0); }
      .admin-card { transition: all 0.3s ease; }
      .admin-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
      html.dark .admin-card:hover { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); }
      .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
      .stat-card.green { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
      .stat-card.orange { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
      .stat-card.purple { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
      .login-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
      .admin-table { border-collapse: separate; border-spacing: 0; }
      .admin-table th { position: sticky; top: 0; z-index: 10; }
      .btn-primary { transition: all 0.3s ease; }
      .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
      .sidebar-item { transition: all 0.2s ease; }
      .sidebar-item:hover { background-color: rgba(255, 255, 255, 0.1); transform: translateX(4px); }
      .sidebar-item.active { background-color: rgba(255, 255, 255, 0.2); border-right: 3px solid #fbbf24; }
      .editor-btn { padding: 8px; border-radius: 6px; background-color: transparent; color: #64748b; transition: all 0.2s ease; border: none; cursor: pointer; }
      .editor-btn:hover { background-color: rgba(100, 116, 139, 0.1); color: #334155; }
      html.dark .editor-btn { color: #94a3b8; }
      html.dark .editor-btn:hover { background-color: rgba(148, 163, 184, 0.1); color: #e2e8f0; }
      .editor-btn.active { background-color: #fbbf24; color: white; }
      [contenteditable="true"]:empty:before { content: attr(placeholder); color: #9ca3af; font-style: italic; }
      [contenteditable="true"]:focus { outline: none; }
      .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .toast { position: fixed; top: 20px; right: 20px; z-index: 1000; min-width: 300px; }
      .toast.show { animation: slideIn 0.3s ease-out; }
      .toast.hide { animation: slideOut 0.3s ease-in; }
      @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
      @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }

      /* Featured article selector styles */
      .article-item { transition: all 0.2s ease; }
      .article-item:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
      .dark .article-item:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }

      /* Line clamp utility */
      .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200">
    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Gallery Item Editor Modal -->
    <div id="gallery-editor-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
                <h2 id="gallery-editor-modal-title" class="text-2xl font-bold text-slate-800 dark:text-slate-200">Add Gallery Event</h2>
                <button onclick="adminDashboard.closeGalleryEditor()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-y-auto p-6">
                <form id="gallery-editor-form" class="space-y-6">
                    <!-- Title -->
                    <div>
                        <label for="gallery-title" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Title *
                        </label>
                        <input type="text" id="gallery-title" name="title" required
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Enter image title">
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="gallery-description" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Description
                        </label>
                        <textarea id="gallery-description" name="description" rows="3"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Enter image description"></textarea>
                    </div>

                    <!-- Multiple Images Section -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Event Images *
                        </label>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">Add multiple images for this event. The first image will be the main/cover image.</p>

                        <!-- Images Container -->
                        <div id="images-container" class="space-y-4">
                            <!-- First Image (Main) -->
                            <div class="image-input-group border border-slate-300 dark:border-slate-600 rounded-lg p-4 bg-slate-50 dark:bg-slate-700" data-index="0">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-medium text-slate-800 dark:text-slate-200">📸 Main Image (Cover)</h4>
                                </div>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Image URL *</label>
                                        <input type="url" name="imageUrl" required
                                            class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"
                                            placeholder="https://example.com/image1.jpg">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Thumbnail URL (optional)</label>
                                        <input type="url" name="thumbnailUrl"
                                            class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"
                                            placeholder="https://example.com/thumb1.jpg">
                                    </div>
                                    <div class="image-preview hidden">
                                        <img src="" alt="Preview" class="w-full h-32 object-cover rounded-md border border-slate-200 dark:border-slate-600">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Add More Images Button -->
                        <div class="mt-4 flex items-center justify-between">
                            <button type="button" id="add-image-btn" onclick="adminDashboard.addImageInput()"
                                class="flex items-center space-x-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>Add Another Image</span>
                            </button>
                            <span class="text-xs text-slate-500 dark:text-slate-400">Maximum 5 images per event</span>
                        </div>
                    </div>

                    <!-- Category -->
                    <div>
                        <label for="gallery-category" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Category
                        </label>
                        <select id="gallery-category" name="categoryId"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                            <option value="">Select a category</option>
                        </select>
                    </div>

                    <!-- Photographer -->
                    <div>
                        <label for="gallery-photographer" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Photographer
                        </label>
                        <input type="text" id="gallery-photographer" name="photographer"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Photographer name">
                    </div>

                    <!-- Location -->
                    <div>
                        <label for="gallery-location" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Location
                        </label>
                        <input type="text" id="gallery-location" name="location"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Photo location">
                    </div>

                    <!-- Date Taken -->
                    <div>
                        <label for="gallery-date-taken" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Date Taken
                        </label>
                        <input type="date" id="gallery-date-taken" name="dateTaken"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                    </div>



                    <!-- Image Preview -->
                    <div id="gallery-image-preview" class="hidden">
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Preview
                        </label>
                        <div class="border border-slate-300 dark:border-slate-600 rounded-lg p-4 bg-slate-50 dark:bg-slate-700">
                            <img id="gallery-preview-img" src="" alt="Preview" class="w-full h-48 object-cover rounded-lg">
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-between p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-700">
                <div class="flex items-center space-x-4">
                    <span id="gallery-save-status" class="text-sm text-slate-600 dark:text-slate-400"></span>
                </div>
                <div class="flex items-center space-x-3">
                    <button type="button" onclick="adminDashboard.closeGalleryEditor()"
                        class="px-6 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">
                        Cancel
                    </button>
                    <button type="button" onclick="adminDashboard.saveGalleryItem()"
                        class="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg btn-primary flex items-center space-x-2">
                        <span id="gallery-save-spinner" class="hidden animate-spin">⏳</span>
                        <span id="gallery-save-btn-text">Save Event</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Category Editor Modal -->
    <div id="gallery-category-editor-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
                <h2 id="gallery-category-editor-modal-title" class="text-2xl font-bold text-slate-800 dark:text-slate-200">Add Gallery Category</h2>
                <button onclick="adminDashboard.closeGalleryCategoryEditor()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-y-auto p-6">
                <form id="gallery-category-editor-form" class="space-y-6">
                    <!-- Name -->
                    <div>
                        <label for="gallery-category-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Category Name *
                        </label>
                        <input type="text" id="gallery-category-name" name="name" required
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Enter category name">
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="gallery-category-description" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Description
                        </label>
                        <textarea id="gallery-category-description" name="description" rows="3"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Enter category description"></textarea>
                    </div>

                    <!-- Color -->
                    <div>
                        <label for="gallery-category-color" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Category Color
                        </label>
                        <div class="flex items-center space-x-3">
                            <input type="color" id="gallery-category-color" name="color" value="#3B82F6"
                                class="w-12 h-12 border border-slate-300 dark:border-slate-600 rounded-lg cursor-pointer">
                            <input type="text" id="gallery-category-color-text"
                                class="flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                                placeholder="#3B82F6" value="#3B82F6">
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-between p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-700">
                <div class="flex items-center space-x-4">
                    <span id="gallery-category-save-status" class="text-sm text-slate-600 dark:text-slate-400"></span>
                </div>
                <div class="flex items-center space-x-3">
                    <button type="button" onclick="adminDashboard.closeGalleryCategoryEditor()"
                        class="px-6 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">
                        Cancel
                    </button>
                    <button type="button" onclick="adminDashboard.saveGalleryCategory()"
                        class="px-6 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg btn-primary flex items-center space-x-2">
                        <span id="gallery-category-save-spinner" class="hidden animate-spin">⏳</span>
                        <span id="gallery-category-save-btn-text">Save Category</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Author Editor Modal -->
    <div id="author-editor-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
                <h2 id="author-editor-modal-title" class="text-2xl font-bold text-slate-800 dark:text-slate-200">Create New Author</h2>
                <button onclick="adminDashboard.closeAuthorEditor()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-y-auto">
                <form id="author-editor-form" class="p-6 space-y-6">
                    <!-- Name -->
                    <div>
                        <label for="author-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Full Name *</label>
                        <input type="text" id="author-name" name="name" required
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-lg font-semibold"
                            placeholder="Enter author's full name...">
                    </div>

                    <!-- Email -->
                    <div>
                        <label for="author-email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Email Address *</label>
                        <input type="email" id="author-email" name="email" required
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="author@onwarddominicans.news">
                    </div>

                    <!-- Avatar URL -->
                    <div>
                        <label for="author-avatar" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Avatar Image URL</label>
                        <input type="url" id="author-avatar" name="avatarUrl"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="https://example.com/avatar.jpg">
                        <div id="avatar-preview" class="mt-3 hidden">
                            <img id="preview-avatar" src="" alt="Avatar Preview" class="w-24 h-24 object-cover rounded-full border border-slate-200 dark:border-slate-600">
                        </div>
                    </div>

                    <!-- Bio -->
                    <div>
                        <label for="author-bio" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Biography</label>
                        <textarea id="author-bio" name="bio" rows="4"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Brief biography of the author..."></textarea>
                    </div>

                    <!-- Status -->
                    <div>
                        <label for="author-status" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Status</label>
                        <select id="author-status" name="isActive"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-between p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-700">
                <div class="flex items-center space-x-4">
                    <span id="author-save-status" class="text-sm text-slate-600 dark:text-slate-400"></span>
                </div>
                <div class="flex items-center space-x-3">
                    <button type="button" onclick="adminDashboard.closeAuthorEditor()"
                        class="px-6 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">
                        Cancel
                    </button>
                    <button type="button" onclick="adminDashboard.saveAuthor()"
                        class="px-6 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg btn-primary flex items-center space-x-2">
                        <span id="author-save-btn-text">Save Author</span>
                        <div id="author-save-spinner" class="hidden spinner"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Article Editor Modal -->
    <div id="article-editor-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
                <h2 id="editor-modal-title" class="text-2xl font-bold text-slate-800 dark:text-slate-200">Create New Article</h2>
                <button onclick="adminDashboard.closeArticleEditor()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-y-auto">
                <form id="article-editor-form" class="p-6 space-y-6">
                    <!-- Title -->
                    <div>
                        <label for="article-title" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Title *</label>
                        <input type="text" id="article-title" name="title" required
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-lg font-semibold"
                            placeholder="Enter article title...">
                    </div>

                    <!-- Summary -->
                    <div>
                        <label for="article-summary" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Summary *</label>
                        <textarea id="article-summary" name="summary" required rows="3"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="Brief summary of the article..."></textarea>
                    </div>

                    <!-- Image URL -->
                    <div>
                        <label for="article-image" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Featured Image URL</label>
                        <input type="url" id="article-image" name="imageUrl"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="https://example.com/image.jpg">
                        <div id="image-preview" class="mt-3 hidden">
                            <img id="preview-img" src="" alt="Preview" class="w-full h-48 object-cover rounded-lg border border-slate-200 dark:border-slate-600">
                        </div>
                    </div>

                    <!-- Author and Category Row -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Author -->
                        <div>
                            <label for="article-author" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Author *</label>
                            <select id="article-author" name="authorId" required
                                class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                                <option value="">Select an author...</option>
                            </select>
                        </div>

                        <!-- Category -->
                        <div>
                            <label for="article-category" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Category *</label>
                            <select id="article-category" name="categoryId" required
                                class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                                <option value="">Select a category...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Status -->
                    <div>
                        <label for="article-status" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Status</label>
                        <select id="article-status" name="status"
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                            <option value="DRAFT">Draft</option>
                            <option value="PENDING">Pending Review</option>
                            <option value="PUBLISHED">Published</option>
                        </select>
                    </div>

                    <!-- Content Editor -->
                    <div>
                        <label for="article-content" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Content *</label>
                        <div class="border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden">
                            <!-- Editor Toolbar -->
                            <div class="bg-slate-50 dark:bg-slate-700 border-b border-slate-300 dark:border-slate-600 p-3 flex flex-wrap gap-2">
                                <button type="button" class="editor-btn" onclick="adminDashboard.formatText('bold')" title="Bold">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"></path>
                                    </svg>
                                </button>
                                <button type="button" class="editor-btn" onclick="adminDashboard.formatText('italic')" title="Italic">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 4l4 16m-4-8h8"></path>
                                    </svg>
                                </button>
                                <div class="w-px bg-slate-300 dark:bg-slate-600"></div>
                                <button type="button" class="editor-btn" onclick="adminDashboard.formatText('insertUnorderedList')" title="Bullet List">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                    </svg>
                                </button>
                                <button type="button" class="editor-btn" onclick="adminDashboard.formatText('insertOrderedList')" title="Numbered List">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                            <!-- Content Area -->
                            <div id="article-content" contenteditable="true"
                                class="min-h-[300px] p-4 focus:outline-none bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100"
                                placeholder="Write your article content here...">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-between p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-700">
                <div class="flex items-center space-x-4">
                    <span id="save-status" class="text-sm text-slate-600 dark:text-slate-400"></span>
                </div>
                <div class="flex items-center space-x-3">
                    <button type="button" onclick="adminDashboard.closeArticleEditor()"
                        class="px-6 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">
                        Cancel
                    </button>
                    <button type="button" onclick="adminDashboard.saveArticle()"
                        class="px-6 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg btn-primary flex items-center space-x-2">
                        <span id="save-btn-text">Save Article</span>
                        <div id="save-spinner" class="hidden spinner"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Container -->
    <div id="admin-app" class="min-h-screen">
        <!-- Login Screen -->
        <div id="login-screen" class="login-container flex items-center justify-center">
            <div class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md mx-4">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-slate-800 dark:text-slate-200 mb-2">
                        <span class="text-yellow-500">ONWARD</span>
                        <span class="text-slate-700 dark:text-slate-300">DOMINICANS</span>
                    </h1>
                    <p class="text-slate-600 dark:text-slate-400">Admin Dashboard</p>
                </div>
                
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Email Address</label>
                        <input type="email" id="email" name="email" required
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="admin@onwarddominicans.news">
                    </div>
                    
                    <div>
                        <label for="password" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Password</label>
                        <input type="password" id="password" name="password" required
                            class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"
                            placeholder="••••••••">
                    </div>
                    
                    <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-4 rounded-lg btn-primary focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2">
                        <span class="login-text">Sign In</span>
                        <div class="spinner hidden inline-block ml-2"></div>
                    </button>
                </form>
                
                <div id="login-error" class="mt-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 rounded-lg hidden">
                    <p class="text-sm">Invalid credentials. Please try again.</p>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard-screen" class="hidden">
            <!-- Top Navigation -->
            <nav class="bg-white dark:bg-slate-800 shadow-lg border-b border-slate-200 dark:border-slate-700">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-16">
                        <div class="flex items-center">
                            <h1 class="text-xl font-bold">
                                <span class="text-yellow-500">ONWARD</span>
                                <span class="text-slate-700 dark:text-slate-300">DOMINICANS</span>
                                <span class="text-sm font-normal text-slate-500 dark:text-slate-400 ml-2">Admin</span>
                            </h1>
                        </div>

                        <div class="flex items-center space-x-4">
                            <button id="theme-toggle" class="p-2 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors">
                                <svg class="w-5 h-5 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                </svg>
                            </button>

                            <div class="relative">
                                <button id="user-menu-button" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                                    <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                        <span class="text-white font-semibold text-sm" id="user-avatar">A</span>
                                    </div>
                                    <span class="text-sm font-medium text-slate-700 dark:text-slate-300" id="user-name">Admin User</span>
                                    <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                
                                <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 z-50">
                                    <div class="py-1">
                                        <a href="#" class="block px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700">Profile Settings</a>
                                        <hr class="border-slate-200 dark:border-slate-700">
                                        <button id="logout-btn" class="block w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-slate-100 dark:hover:bg-slate-700">Sign Out</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <div class="flex">
                <!-- Sidebar -->
                <aside class="w-64 bg-slate-800 dark:bg-slate-900 min-h-screen">
                    <nav class="mt-8">
                        <div class="px-4 space-y-2">
                            <a href="#" class="sidebar-item active flex items-center px-4 py-3 text-white rounded-lg" data-section="dashboard">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                </svg>
                                Dashboard
                            </a>

                            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-slate-300 hover:text-white rounded-lg" data-section="articles">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Articles
                                <span id="articles-count" class="ml-auto bg-yellow-500 text-white text-xs px-2 py-1 rounded-full">0</span>
                            </a>

                            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-slate-300 hover:text-white rounded-lg" data-section="gallery">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                Gallery
                                <span id="gallery-count" class="ml-auto bg-blue-500 text-white text-xs px-2 py-1 rounded-full">0</span>
                            </a>

                            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-slate-300 hover:text-white rounded-lg" data-section="authors">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                Authors
                            </a>

                            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-slate-300 hover:text-white rounded-lg" data-section="categories">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                </svg>
                                Categories
                            </a>

                            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-slate-300 hover:text-white rounded-lg" data-section="analytics">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Analytics
                            </a>

                            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-slate-300 hover:text-white rounded-lg" data-section="settings">
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Settings
                            </a>
                        </div>
                    </nav>
                </aside>

                <!-- Main Content -->
                <main class="flex-1 p-8" id="main-content">
                    <!-- Content will be dynamically loaded here -->
                </main>
            </div>
        </div>
    </div>

    <script>
        // Comprehensive Admin Dashboard with Full Backend Integration
        class AdminDashboard {
            constructor() {
                this.currentUser = null;
                this.currentSection = 'dashboard';
                // Auto-detect API base URL based on current hostname
                const currentHost = window.location.hostname;
                if (currentHost === 'localhost' || currentHost === '127.0.0.1') {
                    // Local development
                    this.apiBase = 'http://localhost:3001/api';
                } else {
                    // Production - use the deployed backend
                    this.apiBase = 'https://onward-dominicans-backend-v2.onrender.com/api';
                }
                this.token = localStorage.getItem('admin-token');
                this.articles = [];
                this.authors = [];
                this.categories = [];
                this.galleryItems = [];
                this.galleryCategories = [];
                this.stats = {};
                this.featuredArticle = null;
                this.currentEditingArticle = null;
                this.currentEditingAuthor = null;
                this.currentEditingGalleryItem = null;
                this.currentEditingGalleryCategory = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupTheme();
                this.checkAuthStatus();
                this.setupArticleEditor();
                this.setupAuthorEditor();
                this.setupGalleryEditors();
            }

            setupEventListeners() {
                // Login form
                document.getElementById('login-form').addEventListener('submit', (e) => this.handleLogin(e));

                // Logout
                document.getElementById('logout-btn').addEventListener('click', () => this.handleLogout());

                // Theme toggle
                document.getElementById('theme-toggle').addEventListener('click', () => this.toggleTheme());

                // User menu
                const userMenuButton = document.getElementById('user-menu-button');
                const userMenu = document.getElementById('user-menu');
                userMenuButton.addEventListener('click', () => userMenu.classList.toggle('hidden'));

                // Close menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!userMenuButton.contains(e.target) && !userMenu.contains(e.target)) {
                        userMenu.classList.add('hidden');
                    }
                });

                // Sidebar navigation
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.getAttribute('data-section');
                        this.showSection(section);
                    });
                });
            }

            setupTheme() {
                const savedTheme = localStorage.getItem('admin-theme') || 'light';
                this.setTheme(savedTheme);
            }

            setTheme(theme) {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                localStorage.setItem('admin-theme', theme);
            }

            toggleTheme() {
                const isDark = document.documentElement.classList.contains('dark');
                this.setTheme(isDark ? 'light' : 'dark');
            }

            async checkAuthStatus() {
                const savedUser = localStorage.getItem('admin-user');
                if (savedUser && this.token) {
                    try {
                        // Verify token with backend
                        const response = await this.makeAPICall('/auth/profile');
                        if (response.success) {
                            this.currentUser = response.data;
                            this.showDashboard();
                        } else {
                            this.showLogin();
                        }
                    } catch (error) {
                        this.showLogin();
                    }
                } else {
                    this.showLogin();
                }
            }

            async handleLogin(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const email = formData.get('email');
                const password = formData.get('password');

                const submitBtn = e.target.querySelector('button[type="submit"]');
                const loginText = submitBtn.querySelector('.login-text');
                const spinner = submitBtn.querySelector('.spinner');

                loginText.textContent = 'Signing In...';
                spinner.classList.remove('hidden');
                submitBtn.disabled = true;

                try {
                    const response = await this.makeAPICall('/auth/login', 'POST', { email, password });

                    if (response.success) {
                        this.token = response.data.token;
                        this.currentUser = response.data.user;
                        localStorage.setItem('admin-token', this.token);
                        localStorage.setItem('admin-user', JSON.stringify(this.currentUser));
                        this.showToast('Login successful!', 'success');
                        this.showDashboard();
                    } else {
                        this.showLoginError(response.message || 'Invalid credentials');
                    }
                } catch (error) {
                    this.showLoginError('Connection error. Please try again.');
                } finally {
                    loginText.textContent = 'Sign In';
                    spinner.classList.add('hidden');
                    submitBtn.disabled = false;
                }
            }

            handleLogout() {
                this.currentUser = null;
                this.token = null;
                localStorage.removeItem('admin-token');
                localStorage.removeItem('admin-user');
                this.showToast('Logged out successfully', 'info');
                this.showLogin();
            }

            showLogin() {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('dashboard-screen').classList.add('hidden');
            }

            showDashboard() {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('dashboard-screen').classList.remove('hidden');
                this.updateUserInfo();
                this.showSection('dashboard');
            }

            updateUserInfo() {
                if (this.currentUser) {
                    const userName = document.getElementById('user-name');
                    const userAvatar = document.getElementById('user-avatar');
                    userName.textContent = this.currentUser.firstName ?
                        `${this.currentUser.firstName} ${this.currentUser.lastName || ''}`.trim() :
                        this.currentUser.username;
                    userAvatar.textContent = (this.currentUser.firstName || this.currentUser.username).charAt(0).toUpperCase();
                }
            }

            showLoginError(message = 'Invalid credentials. Please try again.') {
                const errorElement = document.getElementById('login-error');
                errorElement.querySelector('p').textContent = message;
                errorElement.classList.remove('hidden');
            }

            hideLoginError() {
                document.getElementById('login-error').classList.add('hidden');
            }

            async makeAPICall(endpoint, method = 'GET', data = null) {
                console.log(`🌐 API Call: ${method} ${this.apiBase}${endpoint}`);

                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (this.token) {
                    options.headers['Authorization'] = `Bearer ${this.token}`;
                    console.log('🔑 Using auth token');
                }

                if (data) {
                    options.body = JSON.stringify(data);
                    console.log('📤 Request data:', data);
                }

                try {
                    const response = await fetch(`${this.apiBase}${endpoint}`, options);
                    const result = await response.json();

                    console.log(`📥 API Response (${response.status}):`, result);

                    if (!response.ok) {
                        // Extract detailed error message from backend response
                        const errorMessage = result.error?.message || result.message || 'API call failed';
                        console.error('❌ API Error Details:', result.error);
                        throw new Error(errorMessage);
                    }

                    return result;
                } catch (error) {
                    console.error('❌ API Call failed:', error);
                    throw error;
                }
            }

            // Helper function to validate URLs (including data URLs)
            isValidUrl(string) {
                try {
                    // Accept data URLs for images
                    if (string.startsWith('data:image/')) {
                        return true;
                    }
                    // Accept regular URLs
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' :
                               type === 'error' ? 'bg-red-500' :
                               type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';

                toast.className = `toast ${bgColor} text-white p-4 rounded-lg shadow-lg show`;
                toast.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span>${message}</span>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                `;

                document.getElementById('toast-container').appendChild(toast);

                setTimeout(() => {
                    toast.classList.remove('show');
                    toast.classList.add('hide');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            async showSection(sectionName) {
                // Update sidebar active state
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-section') === sectionName) {
                        item.classList.add('active');
                    }
                });

                this.currentSection = sectionName;
                const mainContent = document.getElementById('main-content');

                // Show loading
                mainContent.innerHTML = '<div class="flex items-center justify-center h-64"><div class="spinner"></div></div>';

                try {
                    switch (sectionName) {
                        case 'dashboard':
                            await this.loadDashboard();
                            break;
                        case 'articles':
                            await this.loadArticles();
                            break;
                        case 'gallery':
                            await this.loadGallery();
                            break;
                        case 'authors':
                            await this.loadAuthors();
                            break;
                        case 'categories':
                            await this.loadCategories();
                            break;
                        case 'analytics':
                            await this.loadAnalytics();
                            break;
                        case 'settings':
                            await this.loadSettings();
                            break;
                        default:
                            mainContent.innerHTML = '<div class="text-center py-12"><h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200">Section not found</h2></div>';
                    }
                } catch (error) {
                    console.error('Error loading section:', error);
                    mainContent.innerHTML = '<div class="text-center py-12"><h2 class="text-2xl font-bold text-red-600">Error loading content</h2></div>';
                }
            }

            async loadDashboard() {
                try {
                    console.log('🔄 Loading dashboard data from backend...');

                    // Load stats with cache busting
                    const timestamp = Date.now();
                    const [articlesResponse, authorsResponse, featuredResponse] = await Promise.all([
                        this.makeAPICall(`/articles?limit=5&_t=${timestamp}`),
                        this.makeAPICall(`/authors?limit=10&_t=${timestamp}`),
                        this.makeAPICall(`/articles/featured/current?_t=${timestamp}`)
                    ]);

                    console.log('📊 Articles response:', articlesResponse);
                    console.log('👥 Authors response:', authorsResponse);
                    console.log('⭐ Featured article response:', featuredResponse);

                    this.articles = articlesResponse.data || [];
                    this.authors = authorsResponse.data || [];
                    this.featuredArticle = featuredResponse.success ? featuredResponse.data : null;

                    console.log(`✅ Loaded ${this.articles.length} articles and ${this.authors.length} authors from backend`);
                    console.log(`⭐ Featured article:`, this.featuredArticle?.title || 'None');

                    // Update article count in sidebar
                    document.getElementById('articles-count').textContent = articlesResponse.meta?.total || 0;

                    const mainContent = document.getElementById('main-content');
                    mainContent.innerHTML = `
                        <div class="mb-8">
                            <h2 class="text-3xl font-bold text-slate-800 dark:text-slate-200">Dashboard</h2>
                            <p class="text-slate-600 dark:text-slate-400 mt-2">Welcome back! Here's what's happening with your news site.</p>
                            <div class="mt-2 text-sm text-green-600 dark:text-green-400">
                                ✅ Data loaded from backend API (${this.articles.length} articles, ${this.authors.length} authors)
                            </div>
                        </div>

                        <!-- Featured Article Management Section -->
                        <div class="mb-8">
                            <div class="bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-xl font-bold text-slate-800 dark:text-slate-200 flex items-center">
                                        <svg class="w-6 h-6 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                        </svg>
                                        Featured Article Management
                                    </h3>
                                    <button onclick="adminDashboard.openFeaturedArticleSelector()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg btn-primary flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                        </svg>
                                        <span>Change Featured</span>
                                    </button>
                                </div>

                                ${this.featuredArticle ? `
                                    <div class="flex flex-col md:flex-row gap-4">
                                        <div class="md:w-1/3">
                                            <img src="${this.featuredArticle.imageUrl || 'https://images.unsplash.com/photo-1495020689067-958852a7765e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'}"
                                                 alt="${this.featuredArticle.title}"
                                                 class="w-full h-32 object-cover rounded-lg">
                                        </div>
                                        <div class="md:w-2/3">
                                            <h4 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-2">${this.featuredArticle.title}</h4>
                                            <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">
                                                By ${this.featuredArticle.author?.name || 'Unknown Author'} •
                                                ${new Date(this.featuredArticle.publishedAt || this.featuredArticle.createdAt).toLocaleDateString()}
                                            </p>
                                            <p class="text-sm text-slate-700 dark:text-slate-300 line-clamp-2">${this.featuredArticle.summary || 'No summary available'}</p>
                                            <div class="mt-3 flex space-x-2">
                                                <button onclick="adminDashboard.editArticle('${this.featuredArticle.id}')" class="text-yellow-600 hover:text-yellow-800 text-sm font-medium">Edit Article</button>
                                                <button onclick="adminDashboard.unsetFeaturedArticle('${this.featuredArticle.id}')" class="text-orange-600 hover:text-orange-800 text-sm font-medium">Remove Featured</button>
                                            </div>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="text-center py-8">
                                        <svg class="w-16 h-16 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                        </svg>
                                        <h4 class="text-lg font-medium text-slate-600 dark:text-slate-400 mb-2">No Featured Article</h4>
                                        <p class="text-slate-500 dark:text-slate-500 mb-4">Select an article to feature on your homepage</p>
                                        <button onclick="adminDashboard.openFeaturedArticleSelector()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg btn-primary">
                                            Select Featured Article
                                        </button>
                                    </div>
                                `}
                            </div>
                        </div>

                        <!-- Stats Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="stat-card text-white p-6 rounded-xl admin-card">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-white/80 text-sm">Total Articles</p>
                                        <p class="text-3xl font-bold">${articlesResponse.meta?.total || 0}</p>
                                        <p class="text-white/80 text-sm mt-1">All time</p>
                                    </div>
                                    <div class="bg-white/20 p-3 rounded-lg">
                                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card green text-white p-6 rounded-xl admin-card">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-white/80 text-sm">Published</p>
                                        <p class="text-3xl font-bold">${this.articles.filter(a => a.status === 'PUBLISHED').length}</p>
                                        <p class="text-white/80 text-sm mt-1">Live articles</p>
                                    </div>
                                    <div class="bg-white/20 p-3 rounded-lg">
                                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card orange text-white p-6 rounded-xl admin-card">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-white/80 text-sm">Authors</p>
                                        <p class="text-3xl font-bold">${authorsResponse.meta?.total || 0}</p>
                                        <p class="text-white/80 text-sm mt-1">Active writers</p>
                                    </div>
                                    <div class="bg-white/20 p-3 rounded-lg">
                                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card purple text-slate-800 p-6 rounded-xl admin-card">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-slate-600 text-sm">Drafts</p>
                                        <p class="text-3xl font-bold">${this.articles.filter(a => a.status === 'DRAFT').length}</p>
                                        <p class="text-slate-600 text-sm mt-1">Pending work</p>
                                    </div>
                                    <div class="bg-slate-800/10 p-3 rounded-lg">
                                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 admin-card">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200">Recent Articles</h3>
                                    <button onclick="adminDashboard.showSection('articles')" class="text-yellow-600 hover:text-yellow-700 text-sm font-medium">View All</button>
                                </div>
                                <div class="space-y-4">
                                    ${this.articles.slice(0, 3).map(article => `
                                        <div class="flex items-center space-x-4 p-3 bg-slate-50 dark:bg-slate-700 rounded-lg">
                                            <img src="${article.imageUrl || 'https://images.unsplash.com/photo-1495020689067-958852a7765e?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&q=60'}" alt="Article" class="w-12 h-12 rounded-lg object-cover">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-slate-800 dark:text-slate-200">${article.title}</h4>
                                                <p class="text-sm text-slate-600 dark:text-slate-400">${new Date(article.createdAt).toLocaleDateString()}</p>
                                            </div>
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getStatusClass(article.status)}">${article.status}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 admin-card">
                                <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200 mb-6">Quick Actions</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="adminDashboard.showSection('articles')" class="flex flex-col items-center p-4 bg-yellow-50 dark:bg-yellow-900/20 hover:bg-yellow-100 dark:hover:bg-yellow-900/30 rounded-lg transition-colors btn-primary">
                                        <svg class="w-8 h-8 text-yellow-600 dark:text-yellow-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-slate-700 dark:text-slate-300">New Article</span>
                                    </button>
                                    <button onclick="adminDashboard.showSection('authors')" class="flex flex-col items-center p-4 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg transition-colors btn-primary">
                                        <svg class="w-8 h-8 text-blue-600 dark:text-blue-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Manage Authors</span>
                                    </button>
                                    <button onclick="adminDashboard.showSection('analytics')" class="flex flex-col items-center p-4 bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-lg transition-colors btn-primary">
                                        <svg class="w-8 h-8 text-green-600 dark:text-green-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-slate-700 dark:text-slate-300">View Analytics</span>
                                    </button>
                                    <button onclick="adminDashboard.showSection('settings')" class="flex flex-col items-center p-4 bg-purple-50 dark:bg-purple-900/20 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg transition-colors btn-primary">
                                        <svg class="w-8 h-8 text-purple-600 dark:text-purple-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Settings</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error('Error loading dashboard:', error);
                    this.showToast('Error loading dashboard data', 'error');
                }
            }

            getStatusClass(status) {
                switch (status) {
                    case 'PUBLISHED':
                        return 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200';
                    case 'DRAFT':
                        return 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200';
                    case 'PENDING':
                        return 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200';
                    default:
                        return 'bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200';
                }
            }

            async loadArticles() {
                try {
                    console.log('🔄 Loading articles from backend...');
                    const timestamp = Date.now();
                    const response = await this.makeAPICall(`/articles?limit=50&_t=${timestamp}`);
                    console.log('📊 Articles API response:', response);

                    this.articles = response.data || [];
                    console.log(`✅ Loaded ${this.articles.length} articles from backend`);

                    const mainContent = document.getElementById('main-content');
                    mainContent.innerHTML = `
                        <div class="mb-8 flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-slate-800 dark:text-slate-200">Articles</h2>
                                <p class="text-slate-600 dark:text-slate-400 mt-2">Manage your news articles and content.</p>
                            </div>
                            <button onclick="adminDashboard.createArticle()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg btn-primary flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>New Article</span>
                            </button>
                        </div>

                        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden">
                            <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <input type="text" id="article-search" placeholder="Search articles..." class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                                        <select id="status-filter" class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                                            <option value="">All Status</option>
                                            <option value="PUBLISHED">Published</option>
                                            <option value="DRAFT">Draft</option>
                                            <option value="PENDING">Pending</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="admin-table w-full">
                                    <thead class="bg-slate-50 dark:bg-slate-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Article</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Author</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Featured</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700" id="articles-table-body">
                                        ${this.articles.map(article => `
                                            <tr class="hover:bg-slate-50 dark:hover:bg-slate-700 ${article.isFeatured ? 'bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400' : ''}">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <img class="h-10 w-10 rounded-lg object-cover" src="${article.imageUrl || 'https://images.unsplash.com/photo-1495020689067-958852a7765e?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&q=60'}" alt="">
                                                        <div class="ml-4">
                                                            <div class="text-sm font-medium text-slate-900 dark:text-slate-100 flex items-center">
                                                                ${article.title}
                                                                ${article.isFeatured ? '<svg class="w-4 h-4 text-yellow-500 ml-2" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>' : ''}
                                                            </div>
                                                            <div class="text-sm text-slate-500 dark:text-slate-400">${article.summary.substring(0, 60)}...</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100">${article.author?.name || 'Unknown'}</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getStatusClass(article.status)}">${article.status}</span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    ${article.isFeatured ?
                                                        '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">⭐ Featured</span>' :
                                                        '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300">Regular</span>'
                                                    }
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400">${new Date(article.createdAt).toLocaleDateString()}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <div class="flex space-x-2">
                                                        <button onclick="adminDashboard.editArticle('${article.id}')" class="text-yellow-600 hover:text-yellow-900">Edit</button>
                                                        ${article.status === 'PUBLISHED' ?
                                                            (article.isFeatured ?
                                                                `<button onclick="adminDashboard.unsetFeaturedArticle('${article.id}')" class="text-orange-600 hover:text-orange-900 font-medium">★ Unfeature</button>` :
                                                                `<button onclick="adminDashboard.setFeaturedArticle('${article.id}')" class="text-green-600 hover:text-green-900 font-medium">☆ Feature</button>`
                                                            ) : ''
                                                        }
                                                        <button onclick="adminDashboard.deleteArticle('${article.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;

                    // Add search and filter functionality
                    this.setupArticleFilters();
                } catch (error) {
                    console.error('Error loading articles:', error);
                    this.showToast('Error loading articles', 'error');
                }
            }

            setupArticleFilters() {
                const searchInput = document.getElementById('article-search');
                const statusFilter = document.getElementById('status-filter');

                const filterArticles = () => {
                    const searchTerm = searchInput.value.toLowerCase();
                    const statusFilter = document.getElementById('status-filter').value;

                    const filteredArticles = this.articles.filter(article => {
                        const matchesSearch = article.title.toLowerCase().includes(searchTerm) ||
                                            article.summary.toLowerCase().includes(searchTerm);
                        const matchesStatus = !statusFilter || article.status === statusFilter;
                        return matchesSearch && matchesStatus;
                    });

                    this.updateArticlesTable(filteredArticles);
                };

                searchInput.addEventListener('input', filterArticles);
                statusFilter.addEventListener('change', filterArticles);
            }

            updateArticlesTable(articles) {
                const tbody = document.getElementById('articles-table-body');
                tbody.innerHTML = articles.map(article => `
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-700 ${article.isFeatured ? 'bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400' : ''}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <img class="h-10 w-10 rounded-lg object-cover" src="${article.imageUrl || 'https://images.unsplash.com/photo-1495020689067-958852a7765e?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&q=60'}" alt="">
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-slate-900 dark:text-slate-100 flex items-center">
                                        ${article.title}
                                        ${article.isFeatured ? '<svg class="w-4 h-4 text-yellow-500 ml-2" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>' : ''}
                                    </div>
                                    <div class="text-sm text-slate-500 dark:text-slate-400">${article.summary.substring(0, 60)}...</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-slate-100">${article.author?.name || 'Unknown'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getStatusClass(article.status)}">${article.status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${article.isFeatured ?
                                '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">⭐ Featured</span>' :
                                '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300">Regular</span>'
                            }
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 dark:text-slate-400">${new Date(article.createdAt).toLocaleDateString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="adminDashboard.editArticle('${article.id}')" class="text-yellow-600 hover:text-yellow-900">Edit</button>
                                ${article.status === 'PUBLISHED' ?
                                    (article.isFeatured ?
                                        `<button onclick="adminDashboard.unsetFeaturedArticle('${article.id}')" class="text-orange-600 hover:text-orange-900 font-medium">★ Unfeature</button>` :
                                        `<button onclick="adminDashboard.setFeaturedArticle('${article.id}')" class="text-green-600 hover:text-green-900 font-medium">☆ Feature</button>`
                                    ) : ''
                                }
                                <button onclick="adminDashboard.deleteArticle('${article.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            async createArticle() {
                console.log('🆕 Opening article creation modal...');
                this.currentEditingArticle = null;
                this.openArticleEditor();
            }

            async editArticle(articleId) {
                console.log('✏️ Opening article editor for:', articleId);
                try {
                    // Load the article data
                    console.log('🔄 Fetching article data from API...');
                    const response = await this.makeAPICall(`/articles/${articleId}`);
                    console.log('📥 Article API response:', response);

                    if (response.success && response.data) {
                        console.log('✅ Article data loaded successfully:', response.data);
                        this.currentEditingArticle = response.data;
                        await this.openArticleEditor(response.data);
                    } else {
                        console.error('❌ Failed to load article data:', response);
                        this.showToast('Failed to load article data', 'error');
                    }
                } catch (error) {
                    console.error('❌ Error loading article:', error);
                    this.showToast('Error loading article data', 'error');
                }
            }

            async openArticleEditor(article = null) {
                const modal = document.getElementById('article-editor-modal');
                const title = document.getElementById('editor-modal-title');
                const form = document.getElementById('article-editor-form');

                // Set modal title
                title.textContent = article ? 'Edit Article' : 'Create New Article';

                // Show modal first
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                try {
                    // Load authors and categories first
                    console.log('🔄 Loading editor data (authors and categories)...');
                    await this.loadEditorData();
                    console.log('✅ Editor data loaded successfully');

                    // Wait a moment for DOM to be ready
                    await new Promise(resolve => setTimeout(resolve, 100));

                    // Then populate form if editing
                    if (article) {
                        console.log('📝 Populating form for article:', article.title);
                        this.populateArticleForm(article);
                    } else {
                        console.log('🆕 Setting up form for new article');
                        form.reset();
                        const contentField = document.getElementById('article-content');
                        const imagePreview = document.getElementById('image-preview');
                        if (contentField) contentField.innerHTML = '';
                        if (imagePreview) imagePreview.classList.add('hidden');
                    }
                } catch (error) {
                    console.error('❌ Error in openArticleEditor:', error);
                    this.showToast('Error loading editor: ' + error.message, 'error');
                }

                // Focus on title field
                setTimeout(() => {
                    document.getElementById('article-title').focus();
                }, 100);
            }

            closeArticleEditor() {
                const modal = document.getElementById('article-editor-modal');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                this.currentEditingArticle = null;
            }

            async loadEditorData() {
                try {
                    console.log('🔄 Loading authors and categories for editor...');

                    // Load authors and categories for dropdowns
                    const [authorsResponse, categoriesResponse] = await Promise.all([
                        this.makeAPICall('/authors?limit=100'),
                        this.makeAPICall('/categories?limit=100')
                    ]);

                    console.log('📊 Authors response:', authorsResponse);
                    console.log('📊 Categories response:', categoriesResponse);

                    // Check if form elements exist
                    const authorSelect = document.getElementById('article-author');
                    const categorySelect = document.getElementById('article-category');

                    if (!authorSelect || !categorySelect) {
                        throw new Error('Author or category select elements not found in DOM');
                    }

                    // Populate authors dropdown
                    authorSelect.innerHTML = '<option value="">Select an author...</option>';
                    if (authorsResponse.success && authorsResponse.data) {
                        authorsResponse.data.forEach(author => {
                            const option = document.createElement('option');
                            option.value = author.id;
                            option.textContent = author.name;
                            authorSelect.appendChild(option);
                        });
                        console.log(`✅ Loaded ${authorsResponse.data.length} authors`);
                    } else {
                        console.warn('⚠️ No authors data received');
                    }

                    // Populate categories dropdown
                    categorySelect.innerHTML = '<option value="">Select a category...</option>';
                    if (categoriesResponse.success && categoriesResponse.data) {
                        categoriesResponse.data.forEach(category => {
                            const option = document.createElement('option');
                            option.value = category.id;
                            option.textContent = category.name;
                            categorySelect.appendChild(option);
                        });
                        console.log(`✅ Loaded ${categoriesResponse.data.length} categories`);
                    } else {
                        console.warn('⚠️ No categories data received');
                    }

                    console.log('✅ Editor data loaded successfully');
                } catch (error) {
                    console.error('❌ Error loading editor data:', error);
                    this.showToast('Error loading editor data: ' + error.message, 'error');
                    throw error; // Re-throw to be caught by openArticleEditor
                }
            }

            populateArticleForm(article) {
                console.log('📝 Populating article form with data:', article);

                try {
                    // Check if all required form elements exist
                    const titleField = document.getElementById('article-title');
                    const summaryField = document.getElementById('article-summary');
                    const imageField = document.getElementById('article-image');
                    const authorField = document.getElementById('article-author');
                    const categoryField = document.getElementById('article-category');
                    const statusField = document.getElementById('article-status');
                    const contentField = document.getElementById('article-content');

                    if (!titleField || !summaryField || !imageField || !authorField || !categoryField || !statusField || !contentField) {
                        throw new Error('One or more form fields are missing from the DOM');
                    }

                    // Populate form fields safely
                    titleField.value = article.title || '';
                    summaryField.value = article.summary || '';
                    imageField.value = article.imageUrl || '';
                    authorField.value = article.authorId || '';
                    categoryField.value = article.categoryId || '';
                    statusField.value = article.status || 'DRAFT';
                    contentField.innerHTML = article.content || '';

                    // Show image preview if URL exists
                    if (article.imageUrl) {
                        this.updateImagePreview(article.imageUrl);
                    }

                    console.log('✅ Article form populated successfully');
                } catch (error) {
                    console.error('❌ Error populating article form:', error);
                    console.error('❌ Article data:', article);
                    console.error('❌ Error details:', error.message);
                    this.showToast('Error populating form data: ' + error.message, 'error');
                }
            }

            async saveArticle() {
                const form = document.getElementById('article-editor-form');
                const formData = new FormData(form);
                const saveBtn = document.getElementById('save-btn-text');
                const saveSpinner = document.getElementById('save-spinner');
                const saveStatus = document.getElementById('save-status');

                // Validate required fields
                const title = formData.get('title');
                const summary = formData.get('summary');
                const authorId = formData.get('authorId');
                const categoryId = formData.get('categoryId');
                const content = document.getElementById('article-content').innerHTML;

                if (!title || !summary || !authorId || !categoryId || !content.trim()) {
                    this.showToast('Please fill in all required fields', 'error');
                    return;
                }

                try {
                    saveBtn.textContent = 'Saving...';
                    saveSpinner.classList.remove('hidden');
                    saveStatus.textContent = 'Saving article...';

                    const articleData = {
                        title: title.trim(),
                        summary: summary.trim(),
                        content: content,
                        imageUrl: formData.get('imageUrl') || null,
                        authorId: authorId,
                        categoryId: categoryId,
                        status: formData.get('status') || 'DRAFT'
                    };

                    let response;
                    if (this.currentEditingArticle) {
                        // Update existing article
                        response = await this.makeAPICall(`/articles/${this.currentEditingArticle.id}`, 'PUT', articleData);
                    } else {
                        // Create new article
                        response = await this.makeAPICall('/articles', 'POST', articleData);
                    }

                    if (response.success) {
                        this.showToast(
                            this.currentEditingArticle ? 'Article updated successfully!' : 'Article created successfully!',
                            'success'
                        );
                        this.closeArticleEditor();

                        // Refresh the articles list
                        if (this.currentSection === 'articles') {
                            this.loadArticles();
                        } else if (this.currentSection === 'dashboard') {
                            this.loadDashboard();
                        }
                    } else {
                        throw new Error(response.error?.message || 'Failed to save article');
                    }
                } catch (error) {
                    console.error('Error saving article:', error);
                    this.showToast('Error saving article: ' + error.message, 'error');
                } finally {
                    saveBtn.textContent = 'Save Article';
                    saveSpinner.classList.add('hidden');
                    saveStatus.textContent = '';
                }
            }

            formatText(command) {
                document.execCommand(command, false, null);
                document.getElementById('article-content').focus();
            }

            updateImagePreview(url) {
                const preview = document.getElementById('image-preview');
                const img = document.getElementById('preview-img');

                if (url && url.trim()) {
                    img.src = url;
                    img.onload = () => {
                        preview.classList.remove('hidden');
                    };
                    img.onerror = () => {
                        preview.classList.add('hidden');
                    };
                } else {
                    preview.classList.add('hidden');
                }
            }

            async deleteArticle(articleId) {
                if (!confirm('Are you sure you want to delete this article?')) return;

                try {
                    const response = await this.makeAPICall(`/articles/${articleId}`, 'DELETE');
                    if (response.success) {
                        this.showToast('Article deleted successfully!', 'success');
                        this.loadArticles(); // Refresh the list
                    }
                } catch (error) {
                    console.error('Error deleting article:', error);
                    this.showToast('Error deleting article', 'error');
                }
            }

            async setFeaturedArticle(articleId) {
                try {
                    console.log('⭐ Setting article as featured:', articleId);
                    const response = await this.makeAPICall(`/articles/${articleId}/feature`, 'POST');
                    if (response.success) {
                        this.showToast('Article set as featured successfully!', 'success');
                        this.loadArticles(); // Refresh the list
                        // Refresh dashboard if we're on it
                        if (this.currentSection === 'dashboard') {
                            this.loadDashboard();
                        }
                    } else {
                        this.showToast(response.error?.message || 'Failed to set article as featured', 'error');
                    }
                } catch (error) {
                    console.error('Error setting featured article:', error);
                    this.showToast('Error setting article as featured', 'error');
                }
            }

            async unsetFeaturedArticle(articleId) {
                try {
                    console.log('🔄 Removing featured status from article:', articleId);
                    const response = await this.makeAPICall(`/articles/${articleId}/feature`, 'DELETE');
                    if (response.success) {
                        this.showToast('Article unfeatured successfully!', 'success');
                        this.featuredArticle = null; // Clear featured article
                        this.loadArticles(); // Refresh the list
                        // Refresh dashboard if we're on it
                        if (this.currentSection === 'dashboard') {
                            this.loadDashboard();
                        }
                    } else {
                        this.showToast(response.error?.message || 'Failed to unfeature article', 'error');
                    }
                } catch (error) {
                    console.error('Error unfeaturing article:', error);
                    this.showToast('Error unfeaturing article', 'error');
                }
            }

            async openFeaturedArticleSelector() {
                try {
                    console.log('🔄 Loading published articles for featured selection...');
                    const response = await this.makeAPICall('/articles?status=PUBLISHED&limit=50');

                    if (!response.success) {
                        this.showToast('Failed to load articles', 'error');
                        return;
                    }

                    const publishedArticles = response.data || [];
                    console.log(`✅ Loaded ${publishedArticles.length} published articles`);

                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                    modal.innerHTML = `
                        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                            <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
                                <h3 class="text-xl font-bold text-slate-800 dark:text-slate-200">Select Featured Article</h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="p-6">
                                <div class="mb-4">
                                    <input type="text" id="featured-search" placeholder="Search articles..."
                                           class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100">
                                </div>

                                <div class="max-h-96 overflow-y-auto" id="featured-articles-list">
                                    ${publishedArticles.length > 0 ? publishedArticles.map(article => `
                                        <div class="article-item border border-slate-200 dark:border-slate-700 rounded-lg p-4 mb-3 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer transition-colors ${article.isFeatured ? 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-600' : ''}"
                                             onclick="adminDashboard.selectFeaturedArticle('${article.id}', this.closest('.fixed'))"
                                             data-title="${article.title.toLowerCase()}"
                                             data-author="${(article.author?.name || '').toLowerCase()}">
                                            <div class="flex gap-4">
                                                <img src="${article.imageUrl || 'https://images.unsplash.com/photo-1495020689067-958852a7765e?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80'}"
                                                     alt="${article.title}"
                                                     class="w-20 h-20 object-cover rounded-lg flex-shrink-0">
                                                <div class="flex-grow">
                                                    <div class="flex items-start justify-between">
                                                        <h4 class="font-semibold text-slate-800 dark:text-slate-200 mb-1">${article.title}</h4>
                                                        ${article.isFeatured ? '<span class="text-yellow-600 dark:text-yellow-400 text-sm font-medium">★ Currently Featured</span>' : ''}
                                                    </div>
                                                    <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">
                                                        By ${article.author?.name || 'Unknown Author'} •
                                                        ${new Date(article.publishedAt || article.createdAt).toLocaleDateString()}
                                                    </p>
                                                    <p class="text-sm text-slate-700 dark:text-slate-300 line-clamp-2">${article.summary || 'No summary available'}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('') : '<p class="text-center text-slate-500 py-8">No published articles available</p>'}
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Add search functionality
                    const searchInput = modal.querySelector('#featured-search');
                    searchInput.addEventListener('input', (e) => {
                        const searchTerm = e.target.value.toLowerCase();
                        const articles = modal.querySelectorAll('.article-item');

                        articles.forEach(article => {
                            const title = article.dataset.title;
                            const author = article.dataset.author;
                            const matches = title.includes(searchTerm) || author.includes(searchTerm);
                            article.style.display = matches ? 'block' : 'none';
                        });
                    });

                } catch (error) {
                    console.error('Error opening featured article selector:', error);
                    this.showToast('Error loading article selector', 'error');
                }
            }

            async selectFeaturedArticle(articleId, modal) {
                try {
                    console.log('⭐ Setting new featured article:', articleId);
                    const response = await this.makeAPICall(`/articles/${articleId}/feature`, 'POST');

                    if (response.success) {
                        this.showToast('Featured article updated successfully!', 'success');
                        modal.remove();

                        // Refresh data
                        await this.loadDashboard();
                        if (this.currentSection === 'articles') {
                            this.loadArticles();
                        }
                    } else {
                        this.showToast(response.error?.message || 'Failed to set featured article', 'error');
                    }
                } catch (error) {
                    console.error('Error setting featured article:', error);
                    this.showToast('Error setting featured article', 'error');
                }
            }

            async loadAuthors() {
                try {
                    const response = await this.makeAPICall('/authors?limit=50');
                    this.authors = response.data || [];

                    const mainContent = document.getElementById('main-content');
                    mainContent.innerHTML = `
                        <div class="mb-8 flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-slate-800 dark:text-slate-200">Authors</h2>
                                <p class="text-slate-600 dark:text-slate-400 mt-2">Manage article authors and contributors.</p>
                            </div>
                            <button onclick="adminDashboard.createAuthor()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg btn-primary flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>New Author</span>
                            </button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${this.authors.map(author => `
                                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 admin-card border-l-4 ${author.isActive ? 'border-green-500' : 'border-gray-400'}">
                                    <div class="flex items-start space-x-4">
                                        <div class="relative">
                                            <img src="${author.avatarUrl || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&q=60'}" alt="${author.name}" class="w-16 h-16 rounded-full object-cover border-2 border-slate-200 dark:border-slate-600">
                                            <div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full ${author.isActive ? 'bg-green-500' : 'bg-gray-400'} border-2 border-white dark:border-slate-800"></div>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 truncate">${author.name}</h3>
                                            <p class="text-sm text-slate-500 dark:text-slate-400 truncate">${author.email}</p>
                                            <p class="text-sm text-slate-600 dark:text-slate-400 mt-1 line-clamp-2">${author.bio || 'No bio available'}</p>
                                            <div class="flex items-center justify-between mt-2">
                                                <span class="text-xs text-slate-500 dark:text-slate-500">${author._count?.articles || 0} articles</span>
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${author.isActive ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 'bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200'}">${author.isActive ? 'Active' : 'Inactive'}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4 flex space-x-2">
                                        <button onclick="adminDashboard.editAuthor('${author.id}')" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg text-sm btn-primary flex items-center justify-center space-x-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <span>Edit</span>
                                        </button>
                                        <button onclick="adminDashboard.deleteAuthor('${author.id}')" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm btn-primary flex items-center justify-center space-x-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                            <span>Delete</span>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } catch (error) {
                    console.error('Error loading authors:', error);
                    this.showToast('Error loading authors', 'error');
                }
            }

            async createAuthor() {
                console.log('🆕 Opening author creation modal...');
                this.currentEditingAuthor = null;
                this.openAuthorEditor();
            }

            async editAuthor(authorId) {
                console.log('✏️ Opening author editor for:', authorId);
                try {
                    // Load the author data
                    const response = await this.makeAPICall(`/authors/${authorId}`);
                    if (response.success && response.data) {
                        this.currentEditingAuthor = response.data;
                        this.openAuthorEditor(response.data);
                    } else {
                        this.showToast('Failed to load author data', 'error');
                    }
                } catch (error) {
                    console.error('Error loading author:', error);
                    this.showToast('Error loading author data', 'error');
                }
            }

            openAuthorEditor(author = null) {
                const modal = document.getElementById('author-editor-modal');
                const title = document.getElementById('author-editor-modal-title');
                const form = document.getElementById('author-editor-form');

                // Set modal title
                title.textContent = author ? 'Edit Author' : 'Create New Author';

                // Populate form if editing
                if (author) {
                    this.populateAuthorForm(author);
                } else {
                    form.reset();
                    document.getElementById('avatar-preview').classList.add('hidden');
                }

                // Show modal
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                // Focus on name field
                setTimeout(() => {
                    document.getElementById('author-name').focus();
                }, 100);
            }

            closeAuthorEditor() {
                const modal = document.getElementById('author-editor-modal');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                this.currentEditingAuthor = null;
            }

            populateAuthorForm(author) {
                document.getElementById('author-name').value = author.name || '';
                document.getElementById('author-email').value = author.email || '';
                document.getElementById('author-avatar').value = author.avatarUrl || '';
                document.getElementById('author-bio').value = author.bio || '';
                document.getElementById('author-status').value = author.isActive ? 'true' : 'false';

                // Show avatar preview if URL exists
                if (author.avatarUrl) {
                    this.updateAvatarPreview(author.avatarUrl);
                }
            }

            async saveAuthor() {
                const form = document.getElementById('author-editor-form');
                const formData = new FormData(form);
                const saveBtn = document.getElementById('author-save-btn-text');
                const saveSpinner = document.getElementById('author-save-spinner');
                const saveStatus = document.getElementById('author-save-status');

                // Validate required fields
                const name = formData.get('name');
                const email = formData.get('email');

                if (!name || !email) {
                    this.showToast('Please fill in all required fields', 'error');
                    return;
                }

                try {
                    saveBtn.textContent = 'Saving...';
                    saveSpinner.classList.remove('hidden');
                    saveStatus.textContent = 'Saving author...';

                    const authorData = {
                        name: name.trim(),
                        email: email.trim(),
                        bio: formData.get('bio') || null,
                        avatarUrl: formData.get('avatarUrl') || null,
                        isActive: formData.get('isActive') === 'true'
                    };

                    let response;
                    if (this.currentEditingAuthor) {
                        // Update existing author
                        response = await this.makeAPICall(`/authors/${this.currentEditingAuthor.id}`, 'PUT', authorData);
                    } else {
                        // Create new author
                        response = await this.makeAPICall('/authors', 'POST', authorData);
                    }

                    if (response.success) {
                        this.showToast(
                            this.currentEditingAuthor ? 'Author updated successfully!' : 'Author created successfully!',
                            'success'
                        );
                        this.closeAuthorEditor();

                        // Refresh the authors list
                        if (this.currentSection === 'authors') {
                            this.loadAuthors();
                        } else if (this.currentSection === 'dashboard') {
                            this.loadDashboard();
                        }
                    } else {
                        throw new Error(response.error?.message || 'Failed to save author');
                    }
                } catch (error) {
                    console.error('Error saving author:', error);
                    this.showToast('Error saving author: ' + error.message, 'error');
                } finally {
                    saveBtn.textContent = 'Save Author';
                    saveSpinner.classList.add('hidden');
                    saveStatus.textContent = '';
                }
            }

            updateAvatarPreview(url) {
                const preview = document.getElementById('avatar-preview');
                const img = document.getElementById('preview-avatar');

                if (url && url.trim()) {
                    img.src = url;
                    img.onload = () => {
                        preview.classList.remove('hidden');
                    };
                    img.onerror = () => {
                        preview.classList.add('hidden');
                    };
                } else {
                    preview.classList.add('hidden');
                }
            }

            async deleteAuthor(authorId) {
                if (!confirm('Are you sure you want to delete this author?')) return;

                try {
                    const response = await this.makeAPICall(`/authors/${authorId}`, 'DELETE');
                    if (response.success) {
                        this.showToast('Author deleted successfully!', 'success');
                        this.loadAuthors(); // Refresh the list
                    }
                } catch (error) {
                    console.error('Error deleting author:', error);
                    this.showToast('Error deleting author', 'error');
                }
            }

            async loadCategories() {
                const mainContent = document.getElementById('main-content');
                mainContent.innerHTML = `
                    <div class="text-center py-12">
                        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200 mb-4">Categories Management</h2>
                        <p class="text-slate-600 dark:text-slate-400">Category management feature coming soon!</p>
                    </div>
                `;
            }

            async loadAnalytics() {
                const mainContent = document.getElementById('main-content');
                mainContent.innerHTML = `
                    <div class="text-center py-12">
                        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200 mb-4">Analytics Dashboard</h2>
                        <p class="text-slate-600 dark:text-slate-400">Analytics feature coming soon!</p>
                    </div>
                `;
            }

            async loadSettings() {
                const mainContent = document.getElementById('main-content');
                mainContent.innerHTML = `
                    <div class="text-center py-12">
                        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200 mb-4">System Settings</h2>
                        <p class="text-slate-600 dark:text-slate-400">Settings feature coming soon!</p>
                    </div>
                `;
            }

            async loadGallery() {
                try {
                    console.log('🖼️ Loading gallery data from backend...');

                    // Load gallery data with cache busting
                    const timestamp = Date.now();
                    const [galleryResponse, galleryCategoriesResponse] = await Promise.all([
                        this.makeAPICall(`/gallery?limit=50&_t=${timestamp}`),
                        this.makeAPICall(`/gallery-categories?limit=50&_t=${timestamp}`)
                    ]);

                    console.log('🖼️ Gallery response:', galleryResponse);
                    console.log('🏷️ Gallery categories response:', galleryCategoriesResponse);

                    this.galleryItems = galleryResponse.data || [];
                    this.galleryCategories = galleryCategoriesResponse.data || [];

                    console.log(`✅ Loaded ${this.galleryItems.length} gallery items and ${this.galleryCategories.length} categories from backend`);

                    // Update gallery count in sidebar
                    document.getElementById('gallery-count').textContent = galleryResponse.meta?.total || 0;

                    const mainContent = document.getElementById('main-content');
                    mainContent.innerHTML = `
                        <div class="mb-8 flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-slate-800 dark:text-slate-200">Gallery Management</h2>
                                <p class="text-slate-600 dark:text-slate-400 mt-2">Manage your photo gallery and categories.</p>
                                <div class="mt-2 text-sm text-green-600 dark:text-green-400">
                                    ✅ Data loaded from backend API (${this.galleryItems.length} items, ${this.galleryCategories.length} categories)
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="adminDashboard.createGalleryCategory()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg btn-primary flex items-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    <span>New Category</span>
                                </button>
                                <button onclick="adminDashboard.createGalleryItem()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg btn-primary flex items-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                    <span>Multi-Image Event</span>
                                </button>
                                <button onclick="adminDashboard.createGalleryItem()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg btn-primary flex items-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    <span>Add Event</span>
                                </button>
                            </div>
                        </div>

                        <!-- Gallery Categories Section -->
                        <div class="mb-8">
                            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg admin-card">
                                <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                                    <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200">Gallery Categories (${this.galleryCategories.length})</h3>
                                </div>
                                <div class="p-6">
                                    ${this.galleryCategories.length > 0 ? `
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            ${this.galleryCategories.map(category => `
                                                <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-6 border border-slate-200 dark:border-slate-600">
                                                    <div class="flex items-center space-x-3 mb-4">
                                                        <div class="w-6 h-6 rounded-full flex-shrink-0" style="background-color: ${category.color}"></div>
                                                        <div class="flex-1 min-w-0">
                                                            <h4 class="text-lg font-medium text-slate-900 dark:text-slate-100 truncate">${category.name}</h4>
                                                            <p class="text-sm text-slate-500 dark:text-slate-400 truncate">/${category.slug}</p>
                                                        </div>
                                                    </div>
                                                    ${category.description ? `<p class="text-sm text-slate-600 dark:text-slate-400 mb-4">${category.description}</p>` : ''}
                                                    <div class="flex items-center justify-between text-xs text-slate-500 dark:text-slate-400">
                                                        <span>${category._count?.galleryItems || 0} items</span>
                                                        <div class="flex space-x-2">
                                                            <button onclick="adminDashboard.editGalleryCategory('${category.id}')" class="text-blue-600 hover:text-blue-800 dark:text-blue-400">Edit</button>
                                                            <button onclick="adminDashboard.deleteGalleryCategory('${category.id}')" class="text-red-600 hover:text-red-800 dark:text-red-400">Delete</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : `
                                        <div class="text-center py-8">
                                            <div class="text-slate-400 dark:text-slate-500 text-4xl mb-4">🏷️</div>
                                            <h3 class="text-lg font-medium text-slate-900 dark:text-slate-100 mb-2">No gallery categories yet</h3>
                                            <p class="text-slate-500 dark:text-slate-400 mb-4">Create categories to organize your gallery items</p>
                                            <button onclick="adminDashboard.createGalleryCategory()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg">Create First Category</button>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>

                        <!-- Gallery Stacks Section -->
                        <div class="mb-8">
                            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg admin-card">
                                <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                                    <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200">Image Stacks</h3>
                                    <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">Grouped images for events and topics</p>
                                </div>
                                <div class="p-6">
                                    ${(() => {
                                        // Get unique stack groups
                                        const stackGroups = new Set();
                                        this.galleryItems.forEach(item => {
                                            if (item.stackGroup) {
                                                stackGroups.add(item.stackGroup);
                                            }
                                        });

                                        if (stackGroups.size > 0) {
                                            const sortedStacks = Array.from(stackGroups).sort();
                                            return `
                                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                    ${sortedStacks.map(stackGroup => {
                                                        const stackItems = this.galleryItems.filter(item => item.stackGroup === stackGroup);
                                                        const coverImage = stackItems.find(item => item.isStackCover) || stackItems[0];
                                                        return `
                                                            <div class="bg-slate-50 dark:bg-slate-700 rounded-lg p-4 border border-slate-200 dark:border-slate-600">
                                                                <div class="flex items-center space-x-3 mb-3">
                                                                    <div class="w-12 h-12 rounded-lg overflow-hidden flex-shrink-0">
                                                                        <img src="${coverImage.thumbnailUrl || coverImage.imageUrl}" alt="${stackGroup}" class="w-full h-full object-cover">
                                                                    </div>
                                                                    <div class="flex-1 min-w-0">
                                                                        <h4 class="text-sm font-medium text-slate-900 dark:text-slate-100 truncate">${stackGroup}</h4>
                                                                        <p class="text-xs text-slate-500 dark:text-slate-400">${stackItems.length} images</p>
                                                                    </div>
                                                                </div>
                                                                <div class="text-xs text-slate-600 dark:text-slate-400">
                                                                    <p>Cover: ${coverImage.title}</p>
                                                                    <p>Created: ${new Date(Math.min(...stackItems.map(item => new Date(item.createdAt)))).toLocaleDateString()}</p>
                                                                </div>
                                                            </div>
                                                        `;
                                                    }).join('')}
                                                </div>
                                            `;
                                        } else {
                                            return `
                                                <div class="text-center py-8">
                                                    <div class="text-slate-400 dark:text-slate-500 text-4xl mb-4">📚</div>
                                                    <h3 class="text-lg font-medium text-slate-900 dark:text-slate-100 mb-2">No image stacks yet</h3>
                                                    <p class="text-slate-500 dark:text-slate-400 mb-4">Create stacks by grouping multiple images for the same event</p>
                                                    <button onclick="adminDashboard.createGalleryItem()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">Add Images to Create Stack</button>
                                                </div>
                                            `;
                                        }
                                    })()}
                                </div>
                            </div>
                        </div>

                        <!-- Gallery Items Section -->
                        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg admin-card">
                            <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                                <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200">Gallery Items (${this.galleryItems.length})</h3>
                            </div>
                            <div class="p-6">
                                ${this.galleryItems.length > 0 ? `
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                        ${this.galleryItems.map(item => `
                                            <div class="bg-slate-50 dark:bg-slate-700 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-600 ${item.stackGroup ? 'ring-2 ring-blue-200 dark:ring-blue-800' : ''}">
                                                <div class="aspect-w-16 aspect-h-12 relative">
                                                    <img src="${item.thumbnailUrl || item.imageUrl}" alt="${item.title}" class="w-full h-48 object-cover">
                                                    ${item.stackGroup ? `
                                                        <div class="absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full flex items-center space-x-1">
                                                            <span>📚</span>
                                                            <span>${this.galleryItems.filter(i => i.stackGroup === item.stackGroup).length}</span>
                                                        </div>
                                                    ` : ''}
                                                    ${item.isStackCover ? `
                                                        <div class="absolute top-2 right-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded-full">
                                                            ⭐ Cover
                                                        </div>
                                                    ` : ''}
                                                </div>
                                                <div class="p-4">
                                                    <h4 class="text-sm font-medium text-slate-900 dark:text-slate-100 truncate mb-2">${item.title}</h4>
                                                    ${item.category ? `
                                                        <div class="flex items-center mb-2">
                                                            <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${item.category.color}"></div>
                                                            <span class="text-xs text-slate-500 dark:text-slate-400">${item.category.name}</span>
                                                        </div>
                                                    ` : ''}
                                                    ${item.stackGroup ? `<p class="text-xs text-blue-600 dark:text-blue-400 mb-2">📚 Stack: ${item.stackGroup} (${item.stackOrder})</p>` : ''}
                                                    <div class="text-xs text-slate-500 dark:text-slate-400 space-y-1">
                                                        ${item.photographer ? `<p>📸 ${item.photographer}</p>` : ''}
                                                        ${item.location ? `<p>📍 ${item.location}</p>` : ''}
                                                        <p>📅 ${new Date(item.createdAt).toLocaleDateString()}</p>
                                                    </div>
                                                    <div class="mt-3 flex space-x-2">
                                                        <button onclick="adminDashboard.editGalleryItem('${item.id}')" class="flex-1 text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-300">Edit</button>
                                                        <button onclick="adminDashboard.deleteGalleryItem('${item.id}')" class="flex-1 text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 dark:bg-red-900 dark:text-red-300">Delete</button>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <div class="text-center py-12">
                                        <div class="text-slate-400 dark:text-slate-500 text-6xl mb-4">🖼️</div>
                                        <h3 class="text-lg font-medium text-slate-900 dark:text-slate-100 mb-2">No gallery items yet</h3>
                                        <p class="text-slate-500 dark:text-slate-400 mb-6">Get started by adding your first image to the gallery</p>
                                        <button onclick="adminDashboard.createGalleryItem()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg">Add Your First Image</button>
                                    </div>
                                `}
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error('Error loading gallery:', error);
                    this.showToast('Error loading gallery data', 'error');
                }
            }

            setupArticleEditor() {
                // Image URL preview
                const imageInput = document.getElementById('article-image');
                if (imageInput) {
                    imageInput.addEventListener('input', (e) => {
                        this.updateImagePreview(e.target.value);
                    });
                }

                // Close modal when clicking outside
                const modal = document.getElementById('article-editor-modal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeArticleEditor();
                        }
                    });
                }

                // Handle Enter key in content editor
                const contentEditor = document.getElementById('article-content');
                if (contentEditor) {
                    contentEditor.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            document.execCommand('insertHTML', false, '<br><br>');
                        }
                    });

                    // Auto-save functionality (optional)
                    let autoSaveTimeout;
                    contentEditor.addEventListener('input', () => {
                        clearTimeout(autoSaveTimeout);
                        autoSaveTimeout = setTimeout(() => {
                            const saveStatus = document.getElementById('save-status');
                            if (saveStatus && this.currentEditingArticle) {
                                saveStatus.textContent = 'Auto-saving...';
                                // You can implement auto-save here if needed
                                setTimeout(() => {
                                    saveStatus.textContent = '';
                                }, 1000);
                            }
                        }, 2000);
                    });
                }

                // Form validation
                const form = document.getElementById('article-editor-form');
                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveArticle();
                    });
                }
            }

            setupAuthorEditor() {
                // Avatar URL preview
                const avatarInput = document.getElementById('author-avatar');
                if (avatarInput) {
                    avatarInput.addEventListener('input', (e) => {
                        this.updateAvatarPreview(e.target.value);
                    });
                }

                // Close modal when clicking outside
                const modal = document.getElementById('author-editor-modal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeAuthorEditor();
                        }
                    });
                }

                // Form validation
                const form = document.getElementById('author-editor-form');
                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveAuthor();
                    });
                }
            }

            setupGalleryEditors() {
                // Setup image input listeners for the initial image
                this.setupImageInputListeners();

                // Gallery category color picker sync
                const colorPicker = document.getElementById('gallery-category-color');
                const colorText = document.getElementById('gallery-category-color-text');
                if (colorPicker && colorText) {
                    colorPicker.addEventListener('input', (e) => {
                        colorText.value = e.target.value;
                    });
                    colorText.addEventListener('input', (e) => {
                        if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                            colorPicker.value = e.target.value;
                        }
                    });
                }

                // Close modals when clicking outside
                const galleryModal = document.getElementById('gallery-editor-modal');
                if (galleryModal) {
                    galleryModal.addEventListener('click', (e) => {
                        if (e.target === galleryModal) {
                            this.closeGalleryEditor();
                        }
                    });
                }

                const galleryCategoryModal = document.getElementById('gallery-category-editor-modal');
                if (galleryCategoryModal) {
                    galleryCategoryModal.addEventListener('click', (e) => {
                        if (e.target === galleryCategoryModal) {
                            this.closeGalleryCategoryEditor();
                        }
                    });
                }

                // Form validation
                const galleryForm = document.getElementById('gallery-editor-form');
                if (galleryForm) {
                    galleryForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveGalleryItem();
                    });
                }

                const galleryCategoryForm = document.getElementById('gallery-category-editor-form');
                if (galleryCategoryForm) {
                    galleryCategoryForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveGalleryCategory();
                    });
                }
            }

            // Gallery Item Management Methods
            async createGalleryItem() {
                console.log('🆕 Opening gallery item creation modal...');
                this.currentEditingGalleryItem = null;
                this.openGalleryEditor();
            }



            async editGalleryItem(itemId) {
                console.log('✏️ Opening gallery item edit modal for:', itemId);
                const item = this.galleryItems.find(i => i.id === itemId);
                if (item) {
                    this.currentEditingGalleryItem = item;
                    this.openGalleryEditor(item);
                } else {
                    this.showToast('Gallery item not found', 'error');
                }
            }

            async deleteGalleryItem(itemId) {
                if (!confirm('Are you sure you want to delete this gallery item?')) return;

                try {
                    const response = await this.makeAPICall(`/gallery/${itemId}`, 'DELETE');
                    if (response.success) {
                        this.showToast('Gallery item deleted successfully', 'success');
                        this.loadGallery(); // Refresh the gallery
                    } else {
                        this.showToast('Failed to delete gallery item', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting gallery item:', error);
                    this.showToast('Error deleting gallery item', 'error');
                }
            }

            openGalleryEditor(item = null) {
                const modal = document.getElementById('gallery-editor-modal');
                const title = document.getElementById('gallery-editor-modal-title');
                const form = document.getElementById('gallery-editor-form');

                // Set modal title
                title.textContent = item ? 'Edit Gallery Event' : 'Add Gallery Event';

                // Load categories
                this.loadGalleryEditorData();

                // Populate form if editing
                if (item) {
                    this.populateGalleryForm(item);
                } else {
                    form.reset();
                    this.resetImageInputs();
                }

                // Show modal
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                // Focus on title field
                setTimeout(() => {
                    document.getElementById('gallery-title').focus();
                }, 100);
            }

            closeGalleryEditor() {
                const modal = document.getElementById('gallery-editor-modal');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                this.currentEditingGalleryItem = null;
            }

            loadGalleryEditorData() {
                // Populate category dropdown
                const categorySelect = document.getElementById('gallery-category');
                categorySelect.innerHTML = '<option value="">Select a category</option>';

                this.galleryCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });
            }



            resetImageInputs() {
                const container = document.getElementById('images-container');

                // Remove all but the first image input
                const groups = container.querySelectorAll('.image-input-group');
                for (let i = 1; i < groups.length; i++) {
                    groups[i].remove();
                }

                // Reset the first image input
                const firstGroup = container.querySelector('.image-input-group');
                const inputs = firstGroup.querySelectorAll('input');
                inputs.forEach(input => input.value = '');

                // Hide preview
                const preview = firstGroup.querySelector('.image-preview');
                preview.classList.add('hidden');

                // Show add button
                document.getElementById('add-image-btn').style.display = 'flex';

                // Setup listeners
                this.setupImageInputListeners();
            }

            populateGalleryForm(item) {
                document.getElementById('gallery-title').value = item.title || '';
                document.getElementById('gallery-description').value = item.description || '';
                document.getElementById('gallery-category').value = item.categoryId || '';
                document.getElementById('gallery-photographer').value = item.photographer || '';
                document.getElementById('gallery-location').value = item.location || '';

                if (item.dateTaken) {
                    const date = new Date(item.dateTaken);
                    document.getElementById('gallery-date-taken').value = date.toISOString().split('T')[0];
                }

                // Reset image inputs first
                this.resetImageInputs();

                // Populate the first image input
                const firstGroup = document.getElementById('images-container').querySelector('.image-input-group');
                const imageInput = firstGroup.querySelector('input[name="imageUrl"]');
                const thumbnailInput = firstGroup.querySelector('input[name="thumbnailUrl"]');

                imageInput.value = item.imageUrl || '';
                thumbnailInput.value = item.thumbnailUrl || '';

                // Show image preview if URL exists
                if (item.imageUrl) {
                    this.updateGalleryImagePreview(imageInput, 0);
                }

                // If this item is part of a stack, load other stack images
                if (item.stackGroup) {
                    this.loadStackImages(item.stackGroup, item.id);
                }
            }

            async loadStackImages(stackGroup, currentItemId) {
                try {
                    // Get all items in this stack
                    const stackItems = this.galleryItems.filter(item =>
                        item.stackGroup === stackGroup && item.id !== currentItemId
                    ).sort((a, b) => (a.stackOrder || 0) - (b.stackOrder || 0));

                    // Add additional image inputs for stack items
                    for (const stackItem of stackItems) {
                        this.addImageInput();

                        // Get the last added image group
                        const container = document.getElementById('images-container');
                        const lastGroup = container.lastElementChild;
                        const imageInput = lastGroup.querySelector('input[name="imageUrl"]');
                        const thumbnailInput = lastGroup.querySelector('input[name="thumbnailUrl"]');

                        imageInput.value = stackItem.imageUrl || '';
                        thumbnailInput.value = stackItem.thumbnailUrl || '';

                        if (stackItem.imageUrl) {
                            const index = container.children.length - 1;
                            this.updateGalleryImagePreview(imageInput, index);
                        }
                    }
                } catch (error) {
                    console.error('Error loading stack images:', error);
                }
            }

            setupImageInputListeners() {
                // Setup listeners for all existing image inputs
                const imageInputs = document.querySelectorAll('.image-input-group input[name="imageUrl"]');
                imageInputs.forEach((input, index) => {
                    input.addEventListener('input', (e) => {
                        this.updateGalleryImagePreview(e.target, index);
                    });
                });
            }

            updateGalleryImagePreview(input, index) {
                const group = input.closest('.image-input-group');
                const preview = group.querySelector('.image-preview');
                const img = preview.querySelector('img');

                if (input.value && input.value.trim()) {
                    img.src = input.value;
                    preview.classList.remove('hidden');
                } else {
                    preview.classList.add('hidden');
                }
            }

            addImageInput() {
                const container = document.getElementById('images-container');
                const currentCount = container.children.length;

                if (currentCount >= 5) {
                    this.showToast('Maximum 5 images allowed per event', 'warning');
                    return;
                }

                const newIndex = currentCount;
                const imageGroup = document.createElement('div');
                imageGroup.className = 'image-input-group border border-slate-300 dark:border-slate-600 rounded-lg p-4 bg-slate-50 dark:bg-slate-700';
                imageGroup.setAttribute('data-index', newIndex);

                imageGroup.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-medium text-slate-800 dark:text-slate-200">📸 Image ${newIndex + 1}</h4>
                        <button type="button" onclick="adminDashboard.removeImageInput(${newIndex})"
                            class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Image URL *</label>
                            <input type="url" name="imageUrl" required
                                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"
                                placeholder="https://example.com/image${newIndex + 1}.jpg">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1">Thumbnail URL (optional)</label>
                            <input type="url" name="thumbnailUrl"
                                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"
                                placeholder="https://example.com/thumb${newIndex + 1}.jpg">
                        </div>
                        <div class="image-preview hidden">
                            <img src="" alt="Preview" class="w-full h-32 object-cover rounded-md border border-slate-200 dark:border-slate-600">
                        </div>
                    </div>
                `;

                container.appendChild(imageGroup);

                // Setup listener for the new input
                const newInput = imageGroup.querySelector('input[name="imageUrl"]');
                newInput.addEventListener('input', (e) => {
                    this.updateGalleryImagePreview(e.target, newIndex);
                });

                // Update button state
                if (currentCount + 1 >= 5) {
                    document.getElementById('add-image-btn').style.display = 'none';
                }

                this.showToast(`Image ${newIndex + 1} input added`, 'success');
            }

            removeImageInput(index) {
                const container = document.getElementById('images-container');
                const group = container.querySelector(`[data-index="${index}"]`);

                if (group && index > 0) { // Don't allow removing the main image
                    group.remove();

                    // Re-index remaining groups
                    const remainingGroups = container.querySelectorAll('.image-input-group');
                    remainingGroups.forEach((group, newIndex) => {
                        group.setAttribute('data-index', newIndex);
                        const title = group.querySelector('h4');
                        if (newIndex === 0) {
                            title.textContent = '📸 Main Image (Cover)';
                            // Remove delete button from main image
                            const deleteBtn = group.querySelector('button');
                            if (deleteBtn) deleteBtn.remove();
                        } else {
                            title.textContent = `📸 Image ${newIndex + 1}`;
                            // Update delete button onclick
                            const deleteBtn = group.querySelector('button');
                            if (deleteBtn) {
                                deleteBtn.setAttribute('onclick', `adminDashboard.removeImageInput(${newIndex})`);
                            }
                        }
                    });

                    // Show add button if under limit
                    if (remainingGroups.length < 5) {
                        document.getElementById('add-image-btn').style.display = 'flex';
                    }

                    this.showToast('Image input removed', 'success');
                }
            }

            async saveGalleryItem() {
                const form = document.getElementById('gallery-editor-form');
                const formData = new FormData(form);
                const saveBtn = document.getElementById('gallery-save-btn-text');
                const saveSpinner = document.getElementById('gallery-save-spinner');
                const saveStatus = document.getElementById('gallery-save-status');

                // Get all image inputs
                const imageGroups = document.querySelectorAll('.image-input-group');
                const images = [];

                // Validate and collect image data
                for (let i = 0; i < imageGroups.length; i++) {
                    const group = imageGroups[i];
                    const imageUrl = group.querySelector('input[name="imageUrl"]').value.trim();
                    const thumbnailUrl = group.querySelector('input[name="thumbnailUrl"]').value.trim();

                    if (!imageUrl) {
                        this.showToast(`Please provide URL for Image ${i + 1}`, 'error');
                        return;
                    }

                    // Validate image URL format
                    if (!this.isValidUrl(imageUrl)) {
                        this.showToast(`Please provide a valid URL for Image ${i + 1}`, 'error');
                        return;
                    }

                    // Validate thumbnail URL if provided
                    if (thumbnailUrl && !this.isValidUrl(thumbnailUrl)) {
                        this.showToast(`Please provide a valid thumbnail URL for Image ${i + 1}`, 'error');
                        return;
                    }

                    images.push({
                        imageUrl,
                        thumbnailUrl: thumbnailUrl && thumbnailUrl.trim() !== '' ? thumbnailUrl.trim() : null,
                        isMain: i === 0 // First image is the main/cover image
                    });
                }

                // Validate required fields
                const title = formData.get('title');
                if (!title) {
                    this.showToast('Please fill in the event title', 'error');
                    return;
                }

                if (images.length === 0) {
                    this.showToast('Please add at least one image', 'error');
                    return;
                }

                try {
                    saveBtn.textContent = 'Saving...';
                    saveSpinner.classList.remove('hidden');
                    saveStatus.textContent = `Saving ${images.length} image(s)...`;

                    // Create stack group name from title if multiple images
                    let stackGroup = null;
                    if (images.length > 1) {
                        stackGroup = title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-') + '-' + Date.now();
                    }

                    // Helper function to convert empty strings to null
                    const getFormValue = (key) => {
                        const value = formData.get(key);
                        return (value && value.trim() !== '') ? value.trim() : null;
                    };

                    // Helper function to format date for backend
                    const getDateValue = (key) => {
                        const value = getFormValue(key);
                        if (!value) return null;

                        try {
                            // If it's already a valid date string, convert to ISO format
                            const date = new Date(value);
                            if (isNaN(date.getTime())) return null;
                            return date.toISOString();
                        } catch (error) {
                            console.warn(`Invalid date format for ${key}:`, value);
                            return null;
                        }
                    };

                    const baseData = {
                        categoryId: getFormValue('categoryId'),
                        photographer: getFormValue('photographer'),
                        location: getFormValue('location'),
                        dateTaken: getDateValue('dateTaken')
                    };

                    // If editing existing item, update it
                    if (this.currentEditingGalleryItem) {
                        const itemData = {
                            ...baseData,
                            title: title.trim(),
                            description: getFormValue('description'),
                            imageUrl: images[0].imageUrl,
                            thumbnailUrl: images[0].thumbnailUrl,
                            stackGroup: images.length > 1 ? stackGroup : null,
                            stackOrder: 1,
                            isStackCover: true
                        };

                        console.log('📤 Sending gallery item update data:', itemData);
                        const response = await this.makeAPICall(`/gallery/${this.currentEditingGalleryItem.id}`, 'PUT', itemData);
                        if (response.success) {
                            this.showToast('Gallery item updated successfully!', 'success');
                            this.closeGalleryEditor();
                            this.loadGallery();
                        } else {
                            const errorMsg = response.error?.message || 'Failed to update gallery item';
                            this.showToast(errorMsg, 'error');
                        }
                        return;
                    }

                    // Create new items
                    const createdItems = [];
                    for (let i = 0; i < images.length; i++) {
                        const image = images[i];
                        const itemData = {
                            ...baseData,
                            title: i === 0 ? title.trim() : `${title.trim()} - Image ${i + 1}`,
                            description: i === 0 ? getFormValue('description') : null,
                            imageUrl: image.imageUrl,
                            thumbnailUrl: image.thumbnailUrl,
                            stackGroup: stackGroup,
                            stackOrder: i + 1,
                            isStackCover: i === 0 // First image is cover
                        };

                        saveStatus.textContent = `Saving image ${i + 1} of ${images.length}...`;
                        console.log(`📤 Sending gallery item data for image ${i + 1}:`, itemData);
                        const response = await this.makeAPICall('/gallery', 'POST', itemData);

                        if (response.success) {
                            createdItems.push(response.data);
                        } else {
                            const errorMsg = response.error?.message || `Failed to save image ${i + 1}`;
                            this.showToast(errorMsg, 'error');
                            console.error(`Error saving image ${i + 1}:`, response);
                            return;
                        }
                    }

                    if (createdItems.length === images.length) {
                        const message = images.length === 1
                            ? 'Gallery item created successfully!'
                            : `Event created with ${images.length} images successfully!`;
                        this.showToast(message, 'success');
                        this.closeGalleryEditor();
                        this.loadGallery(); // Refresh the gallery
                    }

                } catch (error) {
                    console.error('Error saving gallery item:', error);
                    const errorMessage = error.message || 'Error saving gallery item';
                    this.showToast(`Error saving gallery item: ${errorMessage}`, 'error');
                } finally {
                    saveBtn.textContent = 'Save Event';
                    saveSpinner.classList.add('hidden');
                    saveStatus.textContent = '';
                }
            }

            // Gallery Category Management Methods
            async createGalleryCategory() {
                console.log('🆕 Opening gallery category creation modal...');
                this.currentEditingGalleryCategory = null;
                this.openGalleryCategoryEditor();
            }

            async editGalleryCategory(categoryId) {
                console.log('✏️ Opening gallery category edit modal for:', categoryId);
                const category = this.galleryCategories.find(c => c.id === categoryId);
                if (category) {
                    this.currentEditingGalleryCategory = category;
                    this.openGalleryCategoryEditor(category);
                } else {
                    this.showToast('Gallery category not found', 'error');
                }
            }

            async deleteGalleryCategory(categoryId) {
                if (!confirm('Are you sure you want to delete this gallery category?')) return;

                try {
                    const response = await this.makeAPICall(`/gallery-categories/${categoryId}`, 'DELETE');
                    if (response.success) {
                        this.showToast('Gallery category deleted successfully', 'success');
                        this.loadGallery(); // Refresh the gallery
                    } else {
                        this.showToast('Failed to delete gallery category', 'error');
                    }
                } catch (error) {
                    console.error('Error deleting gallery category:', error);
                    this.showToast('Error deleting gallery category', 'error');
                }
            }

            openGalleryCategoryEditor(category = null) {
                const modal = document.getElementById('gallery-category-editor-modal');
                const title = document.getElementById('gallery-category-editor-modal-title');
                const form = document.getElementById('gallery-category-editor-form');

                // Set modal title
                title.textContent = category ? 'Edit Gallery Category' : 'Add Gallery Category';

                // Populate form if editing
                if (category) {
                    this.populateGalleryCategoryForm(category);
                } else {
                    form.reset();
                    document.getElementById('gallery-category-color').value = '#3B82F6';
                    document.getElementById('gallery-category-color-text').value = '#3B82F6';
                }

                // Show modal
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                // Focus on name field
                setTimeout(() => {
                    document.getElementById('gallery-category-name').focus();
                }, 100);
            }

            closeGalleryCategoryEditor() {
                const modal = document.getElementById('gallery-category-editor-modal');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                this.currentEditingGalleryCategory = null;
            }

            populateGalleryCategoryForm(category) {
                document.getElementById('gallery-category-name').value = category.name || '';
                document.getElementById('gallery-category-description').value = category.description || '';
                document.getElementById('gallery-category-color').value = category.color || '#3B82F6';
                document.getElementById('gallery-category-color-text').value = category.color || '#3B82F6';
            }

            async saveGalleryCategory() {
                const form = document.getElementById('gallery-category-editor-form');
                const formData = new FormData(form);
                const saveBtn = document.getElementById('gallery-category-save-btn-text');
                const saveSpinner = document.getElementById('gallery-category-save-spinner');
                const saveStatus = document.getElementById('gallery-category-save-status');

                // Validate required fields
                const name = formData.get('name');

                if (!name) {
                    this.showToast('Please enter a category name', 'error');
                    return;
                }

                try {
                    saveBtn.textContent = 'Saving...';
                    saveSpinner.classList.remove('hidden');
                    saveStatus.textContent = 'Saving gallery category...';

                    const categoryData = {
                        name: name.trim(),
                        description: formData.get('description') || null,
                        color: formData.get('color') || '#3B82F6'
                    };

                    let response;
                    if (this.currentEditingGalleryCategory) {
                        // Update existing category
                        response = await this.makeAPICall(`/gallery-categories/${this.currentEditingGalleryCategory.id}`, 'PUT', categoryData);
                    } else {
                        // Create new category
                        response = await this.makeAPICall('/gallery-categories', 'POST', categoryData);
                    }

                    if (response.success) {
                        this.showToast(this.currentEditingGalleryCategory ? 'Gallery category updated successfully!' : 'Gallery category created successfully!', 'success');
                        this.closeGalleryCategoryEditor();
                        this.loadGallery(); // Refresh the gallery
                    } else {
                        this.showToast('Failed to save gallery category', 'error');
                    }
                } catch (error) {
                    console.error('Error saving gallery category:', error);
                    this.showToast('Error saving gallery category', 'error');
                } finally {
                    saveBtn.textContent = 'Save Category';
                    saveSpinner.classList.add('hidden');
                    saveStatus.textContent = '';
                }
            }
        }

        // Initialize the admin dashboard
        document.addEventListener('DOMContentLoaded', () => {
            window.adminDashboard = new AdminDashboard();
        });
    </script>
